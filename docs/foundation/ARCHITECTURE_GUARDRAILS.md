# 架构守则

## 1. 架构风格

优先采用模块化单体。
早期不直接上微服务。
按业务领域边界拆分，而不是按技术分层归属拆分。

## 2. 领域边界

以下模块必须长期保持明确边界：

- `chat`
- `memory`
- `knowledge`
- `tooling`

`V1.0` 仅启用 `chat`。
其余模块作为预置扩展点保留。

## 3. 租户与版本形态就绪

- 核心业务实体预留 `tenant_id`
- 系统配置必须包含 `edition`：
  - `personal`
  - `enterprise`
- 早期默认模式为 `personal`

## 4. 契约优先原则

- API 请求与响应模型需版本化
- 内部模块接口需显式定义
- 模型与外部系统接入必须通过适配层

## 5. 升级安全规则

- 新功能优先扩展模块，不允许绕过模块边界
- 业务逻辑不得直接绑定单一供应商实现
- 结构性数据变更必须有迁移方案
- 次版本内保持 API 向后兼容

## 6. 后续拆分策略

当出现明确瓶颈（规模、发布节奏、团队协作）时，再按边界拆分服务：

- `chat-service`
- `knowledge-service`
- `tool-runtime`

在瓶颈未出现前，不进行过早微服务化。
