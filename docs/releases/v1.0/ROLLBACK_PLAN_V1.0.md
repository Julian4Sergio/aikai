# Rollback Plan - V1.0

## 1. 目的

当 `V1.0` 发布后出现主链路异常时，快速恢复到稳定状态，最小化用户影响。

## 2. 回滚触发条件

满足任一条件即可触发回滚：

- 问答主链路不可用（持续失败或不可访问）
- 错误率持续高于阈值（由环境策略定义）
- 核心延迟显著劣化并持续（由环境策略定义）
- 出现 Blocker/Critical 级线上缺陷

## 3. 回滚范围

- `POST /api/v1/chat/completions` 新变更路径
- 相关配置变更（超时、错误映射、路由）
- 非必要新能力开关（如有）

不回滚范围：

- `GET /healthz` 基础健康检查可用性
- 日志采集与请求追踪能力

## 4. 回滚前确认

- 确认问题可复现且影响主链路
- 确认当前版本与上一个稳定版本标识
- 通知相关责任人（开发/测试/运维）
- 锁定发布窗口，暂停进一步变更

## 5. 回滚执行步骤

1. 启用回滚决策并记录时间点
2. 切换到上一个稳定版本（代码/镜像/部署单元）
3. 回退相关配置（超时、路由、功能开关）
4. 重启或滚动替换实例
5. 执行回滚后冒烟验证（chat + healthz）
6. 观察 15-30 分钟关键指标并确认稳定

## 6. 回滚验证清单

- [ ] `GET /healthz` 返回 200
- [ ] `POST /api/v1/chat/completions` 返回可用响应
- [ ] 错误率恢复到可接受区间
- [ ] 延迟恢复到历史基线区间
- [ ] 日志 `request_id` 可追踪

## 7. 失败场景与兜底

- 若回滚后仍异常：
  - 启用降级响应（固定安全回复）
  - 暂停外部依赖调用路径（如适用）
  - 保留日志并升级事故等级

## 8. 回滚记录模板

- 触发时间：
- 触发条件：
- 影响范围：
- 执行人：
- 回滚版本：
- 验证结果：
- 后续行动项：

